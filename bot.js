const Discord = require('discord.js');
const client = new Discord.Client({ fetchAllMembers: true });
const fs = require("fs");
const Canvas = require('canvas')
const jimp = require('jimp')
const moment = require('moment');
const dateFormat = require('dateformat');
let done = {};

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);
client.user.setGame(`server BRG `,"http://twitch.tv/S-F")
  console.log('')
  console.log('')
  console.log('â•”[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•—')
  console.log(`[Start] ${new Date()}`);
  console.log('â•š[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•')
  console.log('')
  console.log('â•”[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•—');
  console.log(`Logged in as * [ " ${client.user.username} " ]`);
  console.log('')
  console.log('Informations :')
  console.log('')
  console.log(`servers! [ " ${client.guilds.size} " ]`);
  console.log(`Users! [ " ${client.users.size} " ]`);
  console.log(`channels! [ " ${client.channels.size} " ]`);
  console.log('â•š[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•')
  console.log('')
  console.log('â•”[â•â•â•â•â•â•â•â•â•â•â•â•]â•—')
  console.log(' Bot Is Online')
  console.log('â•š[â•â•â•â•â•â•â•â•â•â•â•â•]â•')
  console.log('')
  console.log('')
});

client.on('message', message => {
    if (message.content === ('$bot')) {
    message.channel.send({
        embed: new Discord.RichEmbed()
            .setAuthor(client.user.username,client.user.avatarURL)
            .setThumbnail(client.user.avatarURL)
            .setColor('RANDOM')
            .addField('**Bot Ping**ğŸš€ :' , [`${Date.now() - message.createdTimestamp}` + 'MS'], true)
            .addField('**Servers**ğŸ“š :', [client.guilds.size], true)
            .addField('**Channels**ğŸ“ :' , `[ ${client.channels.size} ]` , true)
            .addField('**Users**ğŸ”® :' ,`[ ${client.users.size} ]` , true)
            .addField('**Bot Name**ğŸ”° :' , `[ ${client.user.tag} ]` , true)
            .addField('**Bot Owner**ğŸ‘‘ :' , `[<@368124062997938177>]` , true)
            .setFooter(message.author.username, message.author.avatarURL)
    })
}
});


client.on("message", (message) => {
   if (message.content.startsWith("$new")) {     
        const reason = message.content.split(" ").slice(1).join(" ");     
        if (!message.guild.roles.exists("name", "Support Team")) return message.channel.send(`This server doesn't have a \`Support Team\` role made, so the ticket won't be opened.\nIf you are an administrator, make one with that name exactly and give it to users that should be able to see tickets.`);
        if (message.guild.channels.exists("name", "ticket-{message.author.id}" + message.author.id)) return message.channel.send(`You already have a ticket open.`);    
        message.guild.createChannel(`ticket-${message.author.username}`, "text").then(c => {
            let role = message.guild.roles.find("name", "Support Team");
            let role2 = message.guild.roles.find("name", "@everyone");
            c.overwritePermissions(role, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });    
            c.overwritePermissions(role2, {
                SEND_MESSAGES: false,
                READ_MESSAGES: false
            });
            c.overwritePermissions(message.author, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });
            message.channel.send(`:white_check_mark: **ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ°ÙƒØ±ØªÙƒ ØŒ #${c.name}.**`);
            const embed = new Discord.RichEmbed()
                .setColor(0xCF40FA)
                .addField(`Ù…Ø±Ø­Ø¨Ø§Ù‘ ${message.author.username}!`, `ÙŠØ±Ø¬Ù‰ Ù…Ø­Ø§ÙˆÙ„Ø© Ø´Ø±Ø­ Ø³Ø¨Ø¨ ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø¨Ø£ÙƒØ¨Ø± Ù‚Ø¯Ø± Ù…Ù…ÙƒÙ† Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„. Ø³ÙŠÙƒÙˆÙ† ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù„Ø¯ÙŠÙ†Ø§ Ù‚Ø±ÙŠØ¨Ø§ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.`)
                .setTimestamp();
            c.send({
                embed: embed
            });
        }).catch(console.error);
    }
 
 
  if (message.content.startsWith("$close")) {
        if (!message.channel.name.startsWith(`ticket-`)) return message.channel.send(`You can't use the close command outside of a ticket channel.`);
 
        message.channel.send(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯ ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¹ÙƒØ³ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!\n Ù„Ù„ØªØ£ÙƒÙŠØ¯ ØŒ Ø§ÙƒØªØ¨\`$confirm\`. Ø³ÙŠØ¤Ø¯ÙŠ Ø°Ù„Ùƒ Ø¥Ù„Ù‰ Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ© ÙÙŠ ØºØ¶ÙˆÙ† 10 Ø«ÙˆØ§Ù†Ù ÙˆØ¥Ù„ØºØ§Ø¦Ù‡Ø§`)
            .then((m) => {
                message.channel.awaitMessages(response => response.content === '$confirm', {
                        max: 1,
                        time: 10000,
                        errors: ['time'],
                    })   
                    .then((collected) => {
                        message.channel.delete();
                    })    
                    .catch(() => {
                        m.edit('Ticket close timed out, the ticket was not closed.').then(m2 => {
                            m2.delete();
                        }, 3000);
                    });
            });
    }
 
});



client.on('message', msg => {
  if (msg.content === 'ÙÙ„Ø³Ø·ÙŠÙ†') {      
    msg.channel.send(":flag_ps:")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {      
    msg.channel.send("ğŸ‡¸ğŸ‡¦")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ù…ØµØ±') {      
    msg.channel.send("ğŸ‡ªğŸ‡¬")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ù…ØºØ±Ø¨') {      
    msg.channel.send("ğŸ‡²ğŸ‡¦")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø¹Ø±Ø§Ù‚') {      
    msg.channel.send("ğŸ‡®ğŸ‡¶")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±') {      
    msg.channel.send("ğŸ‡©ğŸ‡¿")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø§Ù…Ø§Ø±Ø§Øª') {      
    msg.channel.send("ğŸ‡¦ğŸ‡ª")
  }
});

client.on('message', msg => {
  if (msg.content === 'ØªÙˆÙ†Ø³') {      
    msg.channel.send("ğŸ‡¹ğŸ‡³")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø³ÙˆØ±ÙŠØ§') {      
    msg.channel.send("ğŸ‡¸ğŸ‡¾")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ù„ÙŠØ¨ÙŠØ§') {      
    msg.channel.send("ğŸ‡±ğŸ‡¾")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ù‚Ø·Ø±') {      
    msg.channel.send("ğŸ‡¶ğŸ‡¦")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„ØµÙˆÙ…Ø§Ù„') {      
    msg.channel.send("ğŸ‡¸ğŸ‡´")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø¹Ù…Ø§Ù†') {      
    msg.channel.send("ğŸ‡´ğŸ‡²")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§') {      
    msg.channel.send("ğŸ‡²ğŸ‡·")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø¨Ø§ÙƒØ³ØªØ§Ù†') {      
    msg.channel.send(":flag_pk:")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†') {      
    msg.channel.send(":flag_bh:")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„ÙƒÙˆÙŠØª') {      
    msg.channel.send(":flag_kw:")
  }
});

client.on('message', msg => {
  if (msg.content === 'Ø§Ù„Ø§Ø±Ø¯Ù†') {      
    msg.channel.send(":flag_jo:")
  }
});


client.on('message',function(message) {
  if(!message.channel.guild) return undefined;
  const swearWords = ["Ø´Ø±Ù…ÙˆØ·Ù‡","Ø²Ø¨ÙŠ","Ø§Ù†ÙŠÙƒ","Ù‚Ø­Ø¨Ù‡","Ù†ÙŠÙƒ","Ø²Ø¨","ÙƒØ³"];
  if (swearWords.some(word => message.content.includes(word)) ) {
    message.delete()
    message.reply("Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¨"); 
  }
});


 

client.on("guildMemberAdd", member => {
  member.createDM().then(function (channel) {
  return channel.send(`ÙˆÙ„ÙƒÙ… Ù†ÙˆØ±Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
 ${member}  
 `) 
}).catch(console.error)
});




client.on('message', async msg => {
  if(msg.content.startsWith('$servers')) {
    let output = '**Servers**\n';
    client.guilds.forEach(guild => {
      output += `**Name**: ${guild.name}, **ID**: ${guild.id}, **MembersCount**: ${guild.memberCount}, **Owner**: ${guild.owner}`;
    });
    msg.channel.send(output);
  }
});



client.on('message', function(msg) {
    if(msg.content.startsWith ('$server')) {
      let embed = new Discord.RichEmbed()
      .setColor('RANDOM')
      .setThumbnail(msg.guild.iconURL)
      .setTitle(`Showing Details Of  **${msg.guild.name}*`)
      .addField(':globe_with_meridians:** Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ±ÙØ±**',`[** __${msg.guild.region}__ **]`,true)
      .addField(':medal:** __Ø§Ù„Ø±ØªØ¨__**',`[** __${msg.guild.roles.size}__ **]`,true)
      .addField(':red_circle:**__ Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡__**',`[** __${msg.guild.memberCount}__ **]`,true)
      .addField(':large_blue_circle:**__ Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†__**',`[** __${msg.guild.members.filter(m=>m.presence.status == 'online').size}__ **]`,true)
      .addField(':pencil:**__ Ø§Ù„Ø±ÙˆÙ…Ø§Øª Ø§Ù„ÙƒØªØ§Ø¨ÙŠØ©__**',`[** __${msg.guild.channels.filter(m => m.type === 'text').size}__** ]`,true)
      .addField(':microphone:**__ Ø±ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØª__**',`[** __${msg.guild.channels.filter(m => m.type === 'voice').size}__ **]`,true)
      .addField(':crown:**__ Ø§Ù„Ø£ÙˆÙ†Ù€Ø±__**',`**${msg.guild.owner}**`,true)
      .addField(':id:**__ Ø§ÙŠØ¯ÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±__**',`**${msg.guild.id}**`,true)
      .addField(':date:**__ ØªÙ… Ø¹Ù…Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ__**',msg.guild.createdAt.toLocaleString())
      msg.channel.send({embed:embed});
    }
  });

var p = "*";
client.on('message', message => {
         if (message.content === "$time") {
         if (!message.channel.guild) return message.reply('** This command only for servers **');  
         var currentTime = new Date(),
            hours = currentTime.getHours() + 4 ,
            hours2 = currentTime.getHours() + 3 ,
            hours3 = currentTime.getHours() + 2 ,
            hours4 = currentTime.getHours() + 3 ,
            minutes = currentTime.getMinutes(),
            seconds = currentTime.getSeconds(),
            Year = currentTime.getFullYear(),
            Month = currentTime.getMonth() + 1,
            Day = currentTime.getDate();
             var h = hours
  if(hours > 12) {
               hours -= 12;
            } else if(hours == 0) {
                hours = "12";
            }  
             if(hours2 > 12) {
               hours2 -= 12;
            } else if(hours2 == 0) {
                hours2 = "12";
            
            }  
                         if(hours3 > 12) {
               hours3 -= 12;
            } else if(hours3 == 0) {
                hours3 = "12";
            } 
            if (minutes < 10) {
                minutes = '0' + minutes;
            }

            var suffix = 'ØµØ¨Ø§Ø­Ø§Ù';
            if (hours >= 12) {
                suffix = 'Ù…Ø³Ø§Ø¡';
                hours = hours - 12;
            }
            if (hours == 0) {
                hours = 12;
            }
 

                var Date15= new Discord.RichEmbed()
                .setThumbnail("https://i.imgur.com/ib3n4Hq.png") 
                .setTitle( "ã€Ø§Ù„ØªØ§Ø±ÙŠØ®  ÙˆØ§Ù„ÙˆÙ‚Øªã€")
                .setColor('RANDOM')
                .setFooter(message.author.username, message.author.avatarURL)
                .addField('Ø§Ù„Ø§Ù…Ø§Ø±Ø§Øª',
                "ã€"+ hours + ":" + minutes +":"+ seconds + "ã€")
                 .addField('Ù…ÙƒÙ‡ Ø§Ù„Ù…ÙƒØ±Ù…Ù‡',
                "ã€"+ hours2 + ":" + minutes +":"+ seconds  + "ã€") 
                .addField('Ù…ØµØ±',
                "ã€"+ hours3 + ":" + minutes +":"+ seconds  + "ã€") 
                
                .addField('Date',
                "ã€"+ Day + "-" + Month + "-" + Year +  "ã€")

                 message.channel.sendEmbed(Date15);
        }
    });

client.on('message', message => {
    if (message.content.startsWith("$avatar")) {
        var mentionned = message.mentions.users.first();
    var x5bzm;
      if(mentionned){
          var x5bzm = mentionned;
      } else {
          var x5bzm = message.author;

      }
        const embed = new Discord.RichEmbed()
        .setColor("RANDOM")
        .setImage(`${x5bzm.avatarURL}`)
      message.channel.sendEmbed(embed);
    }
});

client.on('message', message => {
   let embed = new Discord.RichEmbed()

    let args = message.content.split(' ').slice(1).join(' ');
     if(!message.channel.guild) return;
if(message.content.split(' ')[0] == '$bc') {
    if (!message.member.hasPermission("ADMINISTRATOR"))  return;
         message.react("heavy_check_markï¸")
          let embed = new Discord.RichEmbed()
    .setColor("#FF00FF")
    .setThumbnail(message.author.avatarURL)   
                                      .addField('ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© :', "<@" + message.author.id + ">")
                           message.channel.send(***${message.guild.members.filter(m => m.presence.status !== 'all').size}$***: Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ„Ù…ÙŠÙ†); 
                 message.channel.sendEmbed(embed);
        message.guild.members.forEach(m => {
            var bc = new Discord.RichEmbed()
.addField('â— Sender  :', *** â†’ ${message.author.username}#${message.author.discriminator}***)
            .addField('â— Server  :', *** â†’ ${message.guild.name}***)               
    .setColor('#ff0000')
                 .addField('Ù‘', args)
            m.send(``,{embed: bc});
        });
    }
}) 





client.login(process.env.BOT_TOKEN);
